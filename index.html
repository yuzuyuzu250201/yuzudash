<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yuzu Dash - Patch 1.15.6</title>
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #ffda44; --accent-color: #ff7eb3; --neon-blue: #00f2fe; --prestige-gold: #ffaa00; }
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: #0a0a12; font-family: 'Gamja Flower', cursive; overflow: hidden; user-select:none; color: white; transition: background 0.5s ease; }
        #game-container { position: relative; width: 500px; height: 750px; box-shadow: 0 0 60px rgba(0,0,0,1); border-radius: 30px; overflow: hidden; background: #000; z-index: 2; transition: box-shadow 0.3s ease; }
        canvas { display: block; width: 100%; height: 100%; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.85); z-index: 10; backdrop-filter: blur(8px); display: none; }
        #start-ui { display: flex; background: linear-gradient(135deg, rgba(255,218,68,0.8), rgba(255,126,179,0.8)); }
        
        /* [í´ë¦¬ì–´ í™”ë©´ ì „ìš© ìŠ¤íƒ€ì¼] */
        #clear-ui { background: linear-gradient(135deg, rgba(255,218,68,0.9), rgba(0,242,254,0.9)); color: #333; }
        #clear-ui h1 { font-size: 60px; margin: 0; color: #fff; text-shadow: 0 0 20px #ffda44; }
        .reward-btn { background: #ff7e00 !important; color: white !important; font-weight: bold; animation: pulse 1.5s infinite; border: 3px solid white !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .menu-page { padding: 20px; text-align: center; width: 90%; background: rgba(255,255,255,0.1); border-radius: 20px; border: 1px solid var(--neon-blue); max-height: 85%; overflow-y: auto; }
        .btn { padding: 12px 30px; font-size: 24px; cursor: pointer; background: white; color: #ff7eb3; border: none; border-radius: 50px; font-family: 'Gamja Flower', cursive; box-shadow: 0 4px 0px #e6e6e6; transition: 0.1s; width: 220px; margin: 8px; outline: none; }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px 0px #e6e6e6; }
        #hud-top { position: absolute; top: 25px; width: 100%; padding: 0 25px; display: flex; justify-content: space-between; pointer-events: none; z-index: 5; box-sizing: border-box; }
        .hud-item { background: rgba(0,0,0,0.6); padding: 6px 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); margin-bottom: 5px; font-size: 18px; }
        #warning-label { position: absolute; right: 30px; font-size: 60px; color: #ff4444; display: none; font-weight: bold; text-shadow: 0 0 15px white; z-index: 8; pointer-events: none; }
        #revive-flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; z-index: 20; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="game-container">
        <div id="revive-flash"></div>

        <div id="hud-top">
            <div>
                <div id="life-display" class="hud-item">â¤ï¸â¤ï¸â¤ï¸</div>
                <div class="hud-item" style="color: gold;">Coin: <span id="current-coin">0</span> (+<span id="total-hold-coin">0</span>)</div>
            </div>
            <div style="text-align: right;">
                <div class="hud-item" id="mach-display">ğŸš€ ë§ˆí•˜ 1</div>
                <div class="hud-item" id="score-display">â­ 0</div>
            </div>
        </div>

        <div id="warning-label">!</div>

        <div id="start-ui" class="overlay">
            <h1 style="font-size: 56px; margin: 0; text-shadow: 2px 2px #ff7eb3;">Yuzu Dash v1.15.6</h1>
            <div id="main-best-score" style="margin-bottom:15px; font-size: 20px;">ìµœê³  ê¸°ë¡: 0</div>
            <div style="color: gold; font-size: 28px; margin-bottom: 10px;">Total Coin: <span id="start-total-coin">0</span></div>
            <button class="btn" onclick="prepareGame()">ë¹„í–‰ ì‹œì‘!</button>
            <button class="btn" style="background:#6fbcf0; color:white;" onclick="openPage('gacha-ui')">ì•„ì´í…œ & ì»¬ë ‰ì…˜</button>
            <button class="btn" style="background:#a29bfe; color:white;" onclick="openPage('help-ui')">ì–µë–¡ê³„í•´ì—¬??</button>
        </div>

        <div id="clear-ui" class="overlay">
            <div class="menu-page" style="background: rgba(255,255,255,0.8);">
                <h1>STAGE CLEAR!</h1>
                <p style="font-size: 24px; color: #d35400; margin: 10px 0;">ì¶•í•˜í•©ë‹ˆë‹¤! 1000ì  ë„ë‹¬ ì„±ê³µ!</p>
                <p style="font-size: 18px; color: #555;">ë³´ë„ˆìŠ¤ ì½”ì¸ 500ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.</p>
                <hr style="border: 0; border-top: 1px solid #ccc; margin: 20px 0;">
                <p style="font-size: 20px; font-weight: bold; margin-bottom: 15px;">ğŸ í´ë¦¬ì–´ ê¸°ë… íŠ¹ë³„ ë³´ìƒ ğŸ</p>
                <button class="btn reward-btn" onclick="getCyberBuger()">í´ë¦¬ì–´ ë³´ìƒìœ¼ë¡œ ì‹¸ì´ë²„ê±° ë°›ê¸°</button>
                <br>
                <button class="btn" style="background:#6fbcf0; color:white; width: 180px; font-size: 18px;" onclick="openPage('start-ui')">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>

        <div id="help-ui" class="overlay">
            <div class="menu-page">
                <h2 style="margin: 10px 0;">â“ í”Œë ˆì´ ê°€ì´ë“œ</h2>
                <div class="help-content">
                    <h3>1. í”Œë ˆì´ ë°©ë²•</h3>
                    <ul>
                        <li><b>í”Œë˜í”¼ ë²„ë“œ ì•„ì‹œì£ ???</b> í´ë¦­/ìŠ¤í˜ì´ìŠ¤ë¡œ ì í”„!</li>
                        <li><b>50ì  ì´í›„</b>ë¶€í„°ëŠ” ê´´ì¦ˆ ë“±ì¥! ìš°í´ë¦­/Që¡œ ì²˜ì¹˜!</li>
                        <li><b>í´ë¦¬ì–´ ì¡°ê±´</b>ì€ ë‹¹ë‹¹í•œ 1000ì  ëŒíŒŒì…ë‹ˆë‹¤.</li>
                    </ul>
                </div>
                <button class="btn" style="background:#6fbcf0; color:white;" onclick="openPage('start-ui')">ì•Œê²Œì¨ìš”!</button>
            </div>
        </div>

        <div id="gacha-ui" class="overlay">
            <div class="menu-page">
                <h2 style="margin: 10px 0;">ğŸ ì•„ì´í…œ ìƒì </h2>
                <div style="font-size: 22px; color: gold; margin-bottom:12px;">ë³´ìœ  ì½”ì¸: <span class="coin-val">0</span></div>
                <button class="btn" style="width: 220px; font-size: 20px; background: gold; color: black;" onclick="drawGacha()">ê°€ì±  (50 ì½”ì¸)</button>
                <div class="grid" id="collection-grid"></div>
                <button class="btn" style="background:#6fbcf0; color:white; margin-top: 20px;" onclick="openPage('start-ui')">ë’¤ë¡œê°€ê¸°</button>
            </div>
        </div>

        <div id="count-ui" class="overlay" style="font-size: 120px; font-weight: bold;"></div>
        <canvas id="gameCanvas" width="500" height="750"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const bgm = new Audio('FutureJuice.mp3'); bgm.loop = true;

        // ì•„ì´í…œ ë° ë°ì´í„° ì´ˆê¸°í™” (ì´ì „ íŒ¨ì¹˜ì™€ ë™ì¼)
        const ITEM_LIST = [
            { id: 'cutlet', name: 'ëˆê¹Œì“°', desc: 'ë¼ì´í”„+1', img: 'gacha_don.webp' },
            { id: 'tangerine', name: 'ìœ ì¦ˆê·¤', desc: '3ë°©í–¥ë°œì‚¬', img: 'gacha_gyul.webp' },
            { id: 'lemon', name: 'ë ˆëª¬', desc: 'ê´´ì¦ˆ ì²˜ì¹˜ì‹œ ì½”ì¸ 100%', img: 'gacha_lemon.webp' },
            { id: 'altman', name: 'ìƒ˜ ì•ŒíŠ¸ë§Œ', desc: 'W: 2ì´ˆê°„ í˜¸ë²„ë§', img: 'gacha_altman.webp' },
            { id: 'banana', name: 'ë‚˜ë…¸ë°”ë‚˜ë‚˜', desc: '50íŒŒì´í”„ë‹¹ Life+1', img: 'gacha_banana.webp' },
            { id: 'yuzudoro', name: 'YUZUDORO', desc: '1íšŒ ë¶€í™œ ê°€ëŠ¥', img: 'gacha_yuzudoro.webp' }
        ];

        let data = {
            highscore: parseInt(localStorage.getItem('yuzuHighScore')) || 0,
            coins: parseInt(localStorage.getItem('yuzuCoins')) || 0,
            collection: JSON.parse(localStorage.getItem('yuzuCollection')) || [],
            activeItems: JSON.parse(localStorage.getItem('yuzuActiveItems')) || []
        };

        let gameState = 'STOP', score = 0, lives = 3, gameSpeed = 2.5, frameCount = 0;
        let pipes = [], bullets = [], enemies = [], coins = [], invincible = 0, sessionCoins = 0;
        let canRevive = false;

        const yuzuImg = new Image(); yuzuImg.src = 'yuzu.webp';
        const enemyImg = new Image(); enemyImg.src = 'enemy_wildyuzu.webp';
        const bulletImg = new Image(); bulletImg.src = 'attack.webp';
        const player = { x: 70, y: 350, width: 55, height: 55, gravity: 0.24, velocity: 0, jump: -7.2 };

        function openPage(id) {
            document.querySelectorAll('.overlay').forEach(el => el.style.display = 'none');
            if(id !== 'none') document.getElementById(id).style.display = 'flex';
            if(id === 'gacha-ui') renderCollection();
            updateDataUI();
        }

        function updateDataUI() {
            document.getElementById('start-total-coin').innerText = data.coins;
            document.querySelectorAll('.coin-val').forEach(el => el.innerText = data.coins);
            document.getElementById('main-best-score').innerText = `ìµœê³  ê¸°ë¡: ${data.highscore}`;
        }

        // [í•µì‹¬ ê¸°ëŠ¥] ë¦­ë¡¤ë§ ë§í¬ ì—°ê²°
        function getCyberBuger() {
            window.open("https://youtu.be/dQw4w9WgXcQ?si=gCP7CWn2bagdjm9e", "_blank");
        }

        function gameClear() {
            gameState = 'STOP'; bgm.pause();
            data.coins += sessionCoins + 500;
            if(score > data.highscore) data.highscore = score;
            saveData();
            openPage('clear-ui'); // í´ë¦¬ì–´ ì „ìš© í™”ë©´ ì¶œë ¥
        }

        function prepareGame() {
            openPage('none'); resetGame();
            let count = 3;
            const cntUI = document.getElementById('count-ui');
            const timer = setInterval(() => {
                if (count >= 0) { cntUI.innerText = count === 0 ? "GO!" : count; cntUI.style.display = 'flex'; count--; }
                else { clearInterval(timer); cntUI.style.display = 'none'; gameState = 'PLAYING'; bgm.currentTime = 0; bgm.play(); animate(); }
            }, 800);
        }

        function resetGame() {
            player.y = 350; player.velocity = 0;
            pipes = []; bullets = []; enemies = []; coins = [];
            score = 0; sessionCoins = 0; frameCount = 0;
            gameSpeed = 2.5; invincible = 0;
            lives = data.activeItems.includes('cutlet') ? 4 : 3;
            canRevive = data.activeItems.includes('yuzudoro');
            document.body.style.background = "#0a0a12";
            document.getElementById('game-container').style.boxShadow = "0 0 60px rgba(0,0,0,1)";
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('score-display').innerText = `â­ ${score}`;
            document.getElementById('life-display').innerText = "â¤ï¸".repeat(Math.max(0, lives));
            if (score >= 1000) gameClear();
        }

        function drawVisuals() {
            // ì™¸ë¶€ ê´‘ì„  íš¨ê³¼
            let glowColor = "rgba(0,0,0,0)";
            if (score >= 1000) {
                const hue = (frameCount % 360);
                glowColor = `hsla(${hue}, 70%, 50%, 0.8)`;
                document.body.style.background = `hsl(${hue}, 20%, 5%)`;
            } else if (score >= 100) {
                const stage = Math.floor(score / 100);
                glowColor = `hsla(${240 + stage*30}, 70%, 50%, 0.5)`;
            }
            document.getElementById('game-container').style.boxShadow = `0 0 80px ${glowColor}`;

            ctx.fillStyle = '#0f0c29'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
            for(let i=0; i<15; i++) {
                let x = (i * 50 + frameCount * 0.5) % canvas.width;
                let y = (i * 170) % canvas.height;
                ctx.beginPath(); ctx.arc(x, y, 1, 0, Math.PI*2); ctx.fill();
            }
        }

        function drawPipe(x, y) {
            ctx.fillStyle = '#00f2fe';
            ctx.fillRect(x, 0, 70, y);
            ctx.fillRect(x, y + 260, 70, canvas.height);
        }

        function animate() {
            if (gameState !== 'PLAYING') return;
            drawVisuals();
            if (invincible > 0) { invincible--; ctx.globalAlpha = (frameCount % 10 < 5) ? 0.3 : 0.8; }
            player.velocity += player.gravity; player.y += player.velocity;
            if (player.y + player.height > canvas.height) { gameOver(); return; }
            ctx.drawImage(yuzuImg, player.x, player.y, player.width, player.height);
            ctx.globalAlpha = 1.0;

            if (frameCount % 140 === 0) {
                const py = Math.random() * (canvas.height - 450) + 100;
                pipes.push({ x: 500, y: py, passed: false });
            }
            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= gameSpeed; drawPipe(pipes[i].x, pipes[i].y);
                if (!pipes[i].passed && pipes[i].x + 70 < player.x) { score++; pipes[i].passed = true; updateHUD(); }
                if (invincible === 0 && player.x+8 < pipes[i].x+70 && player.x+player.width-8 > pipes[i].x && (player.y+8 < pipes[i].y || player.y+player.height-8 > pipes[i].y+260)) takeDamage();
                if (pipes[i].x < -80) pipes.splice(i, 1);
            }
            if (frameCount % 300 === 0 && score >= 40) {
                document.getElementById('warning-label').style.top = (Math.random()*500+100)+"px";
                document.getElementById('warning-label').style.display = "block";
                setTimeout(() => { document.getElementById('warning-label').style.display = "none"; if(gameState==='PLAYING') enemies.push({ x: 500, y: parseFloat(document.getElementById('warning-label').style.top) }); }, 800);
            }
            for (let i = enemies.length - 1; i >= 0; i--) {
                enemies[i].x -= (gameSpeed + 1.5); ctx.drawImage(enemyImg, enemies[i].x, enemies[i].y, 55, 55);
                if (invincible === 0 && player.x < enemies[i].x+40 && player.x+40 > enemies[i].x && player.y < enemies[i].y+40 && player.y+40 > enemies[i].y) { takeDamage(); enemies.splice(i, 1); }
                else if (enemies[i].x < -60) enemies.splice(i, 1);
            }
            frameCount++; requestAnimationFrame(animate);
        }

        function takeDamage() { 
            lives--; updateHUD(); 
            if (lives <= 0) {
                if (canRevive) { 
                    canRevive = false; lives = 1; invincible = 150; 
                    const flash = document.getElementById('revive-flash');
                    flash.style.opacity = '0.8'; setTimeout(() => { flash.style.opacity = '0'; }, 300);
                } else gameOver(); 
            } else invincible = 90;
        }

        function gameOver() { gameState = 'STOP'; bgm.pause(); saveData(); openPage('start-ui'); }
        function saveData() { localStorage.setItem('yuzuCoins', data.coins); localStorage.setItem('yuzuHighScore', data.highscore); }

        window.addEventListener('keydown', (e) => { if (gameState==='PLAYING' && e.code==='Space') player.velocity=player.jump; });
        window.addEventListener('mousedown', (e) => { if (gameState==='PLAYING' && e.button===0) player.velocity=player.jump; });
        window.onload = () => { updateDataUI(); };
    </script>
</body>
</html>
